<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../iron-collapse/iron-collapse.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-icons/communication-icons.html">
<link rel="import" href="../iron-icons/hardware-icons.html">
<link rel="import" href="../iron-icons/maps-icons.html">
<link rel="import" href="../iron-icons/social-icons.html">
<link rel="import" href="../iron-icons/editor-icons.html">
<link rel="import" href="../paper-badge/paper-badge.html">
<link rel="import" href="../paper-card/paper-card.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-item/paper-icon-item.html">

<dom-module id="person-card">
  <template>
    <style>
      :host {
        display: block;
        --eye-color: black;
        --iron-icon-fill-color: #4bb6d6;
      }

      hr {
        height: 1px;
        border: 0;
        border-top: 1px solid #ccc;
        margin: .5em 0;
        padding: 0;
      }

      paper-card {
        vertical-align: top;
        width: 100%;
        margin: 10px;
        --paper-card-header: {
          height: 150px;
        };
        --paper-card-header-image: {
          object-fit: cover;
        };
        --paper-card-header-image-text:{
          color:white;
          text-shadow: 0px 0px 7px rgba(150, 150, 150, 1);
        }
      }

      .eye-color {
        height: 24px;
        width: 24px;
        border-radius: 50%;
        background-color: var(--eye-color);
      }

      .chip-list {
        padding: 10px 0;
      }

      .chip {
        display: inline-block;
        background: #e0e0e0;
        padding: 0 12px;
        border-radius: 32px;
        font-size: 13px;
        height: 32px;
        line-height: 32px;
        margin: 0 5px 3px 0;
      }
      .fruit {
        font-size: 24px;
      }
      .label {
        font-size: 13px;
        color: #114453;
      }
      .online-icon {
        font-size: 20px;
        color: #00BB33;
      }
      .flex-horizontal {
        @apply --layout-horizontal;
      }
      .flex-child {
        @apply --layout-flex;
      }
      .flex-center-justified {
        @apply --layout-horizontal;
        @apply --layout-center-justified;
      }
      .status{
        align-items: center;
        padding-top: 5px;
        padding-right: 10px;
      }
    </style>
    <paper-card heading="{{person.name.last}}, {{person.name.first}}" image="{{person.picture}}">
    <div class="card-content">
      <div class="container flex-horizontal">
        <div class="flex-child">
          <div class="chip-list">
            <dom-repeat items="{{person.tags}}" as="tag">
              <template>
                <div class="chip">
                  {{tag}}
                </div>
              </template>
            </dom-repeat>
          </div>
        </div>
        <template is="dom-if" if="{{person.isActive}}">
          <div class="status"><span class="online-icon"> ‚ñ† </span> Active</div>
        </template>
        <paper-icon-button id="number" icon="communication:email" alt="inbox">
        </paper-icon-button>
        <paper-badge for="number" label="{{unreadMessages}}">
        </paper-badge>
      </div>
      <paper-item>
        <paper-item-body two-line>
          <div class="label">About</div>
          <div secondary>{{person.about}}</div>
        </paper-item-body>
      </paper-item>
      <iron-collapse opened="{{isOpen}}">
        <hr>
        <paper-icon-item>
          <iron-icon icon="communication:email" slot="item-icon"></iron-icon>
          <paper-item-body two-line>
            <div class="label">Email</div>
            <div secondary>{{person.email}}</div>
          </paper-item-body>
        </paper-icon-item>
        <paper-icon-item>
          <iron-icon icon="communication:phone" slot="item-icon"></iron-icon>
          <paper-item-body two-line>
            <div class="label">Phone</div>
            <div secondary>{{person.phone}}</div>
          </paper-item-body>
        </paper-icon-item>
        <paper-icon-item>
          <iron-icon icon="social:domain" slot="item-icon"></iron-icon>
          <paper-item-body two-line>
            <div class="label">Company</div>
            <div secondary>{{person.company}}</div>
          </paper-item-body>
        </paper-icon-item>
        <paper-icon-item>
          <iron-icon icon="social:cake" slot="item-icon"></iron-icon>
          <paper-item-body two-line>
            <div class="label">Age</div>
            <div secondary>{{person.age}}</div>
          </paper-item-body>
        </paper-icon-item>
        <paper-icon-item>
          <iron-icon icon="editor:attach-money" slot="item-icon"></iron-icon>
          <paper-item-body two-line>
            <div class="label">Balance</div>
            <div secondary>{{maskBalance()}}</div>
          </paper-item-body>
        </paper-icon-item>
        <paper-icon-item>
          <div class="eye-color" slot="item-icon"></div>
          <paper-item-body two-line>
            <div class="label">Eye color</div>
            <div secondary>{{person.eyeColor}}</div>
          </paper-item-body>
        </paper-icon-item>
        <paper-icon-item>
          <span slot="item-icon" class="fruit">
            {{getFavoriteFruit()}}
          </span>
          <paper-item-body two-line>
            <div class="label">Favorite Fruit</div>
            <div secondary>{{person.favoriteFruit}}</div>
          </paper-item-body>
        </paper-icon-item>
        <paper-icon-item>
          <iron-icon icon="maps:place" slot="item-icon"></iron-icon>
          <paper-item-body two-line>
            <div class="label">Address</div>
            <div secondary>{{person.address}}</div>
          </paper-item-body>
        </paper-icon-item>
        <paper-item class="label">Location</paper-item>
        <div class="container flex-center-justified">
          <img src="{{getMapURL()}}"/>
        </div>
        <hr/>
        <paper-item class="label">Friends</paper-item>
        <dom-repeat items="{{person.friends}}" as="friend">
          <template>
            <paper-item>{{friend.name}}</paper-item>
          </template>
        </dom-repeat>
      </iron-collapse>
    </div>
    <div class="card-actions">
      <paper-button on-click="expandMoreInfo">
        <template is="dom-if" if="{{isOpen}}">
          COLLAPSE
        </template>
        <template is="dom-if" if="{{!isOpen}}">
          EXPAND
        </template>
      </paper-button>
    </div>
    </paper-card>
  </template>
  <script>
    Polymer.setPassiveTouchGestures(true);
    /**
     * `person-card`
     *
     *
     * @customElement
     * @polymer
     */
    class PersonCard extends Polymer.Element {
      static get is() {
        return 'person-card';
      }

      static get properties() {
        return {
          person: {
            type: Object,
            value: {},
            reflectToAttribute: true,
            observer: '_listenPerson'
          } ,
          isOpen: {
            type: Boolean,
            value: false
          },
          unreadMessages: {
            type: Number,
            value: 0
          }
        };
      }

      expandMoreInfo() {
        this.set('isOpen', !this.isOpen);
      }

      maskBalance() {
        var rgx = /[$,]+/g;
        return this.person.balance.replaceAll(rgx, "");
      }

      getMapURL() {
        return `http://dev.virtualearth.net/REST/v1/Imagery/Map/Road/${this.person.latitude},${this.person.longitude}/5?mapSize=500,225&pp=${this.person.latitude},${this.person.longitude};66&mapLayer=Basemap,Buildings&key=AuK_RR4rfzQdoyrg7zoWCOzT_3wCjZaxSTNrq5s5_CfF4vmd46JX_oPwi3pSxIli`;
      }

      getFavoriteFruit() {
        const fruits = {
          'banana': 'üçå',
          'apple': 'üçé',
          'strawberry':  'üçì'
        };
        return fruits[this.person.favoriteFruit];
      }

      _setUnreadMessages() {
        this.set('unreadMessages', this.person.greeting.replace(/\D/g, ''));
      }
      _setEyeColor() {
        const colors = {
          'blue': '#17a9ba',
          'green': '#3aa447',
          'brown':  '#ac6434'
        };
        this.updateStyles({'--eye-color': colors[this.person.eyeColor]});
      }

      _listenPerson() {
        this._setEyeColor();
        this._setUnreadMessages();
      }

    }

    window.customElements.define(PersonCard.is, PersonCard);
  </script>
</dom-module>
